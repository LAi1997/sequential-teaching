<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Init</title>
</head>
<body>
<?php
    function getCurrentSessionId(){
        $csvFile = file('./participant_code.csv');
        $data = [];
        $count = 0;
        $currentSessionId = 0;
        foreach ($csvFile as $line) {
            if ($count > 0) {
                $count = $count + 1;
                $data[] = str_getcsv($line);
                if($data[2]==0){
                    $currentSessionId = $count;
                    $data[2] = 1;
                }
            }
        }

        if($currentSessionId==0) {
            $currentSessionId=$count;
        }

        $fp = fopen('./participant_code.csv', 'w');

        foreach ($data as $fields) {
            fputcsv($fp, $fields);
        }

        fclose($fp);

        return $currentSessionId;
    }
?>
<script type='text/javascript'>
    var currentSessionId = "<?php echo getCurrentSessionId() ?>";
    sessionStorage.setItem("currentSessionId", currentSessionId);
    console.log(currentSessionId);
    const currentAddr = window.location.href;
    window.location.href = currentAddr + "/index.html";
</script>
</body>
</html>